<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="España 2026">
<meta name="theme-color" content="#0a1628">
<title>España 2026</title>
<link rel="apple-touch-icon" href="icon-180.png">
<link rel="icon" type="image/png" href="icon-180.png">

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  :root {
    --safe-top: env(safe-area-inset-top, 20px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --red: #e63946;
    --red-dark: #c1121f;
    --blue: #1d3557;
    --blue-light: #457b9d;
    --blue-bright: #2196f3;
    --white: #f1faee;
    --bg: #0a1628;
    --card: #111d33;
    --card-hover: #162440;
    --text: #f1faee;
    --text-dim: #8899b0;
    --border: rgba(255,255,255,0.06);
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* Sync */
  .sync-bar {
    position: fixed; top: 0; left: 0; right: 0; z-index: 200;
    text-align: center; padding: 3px 0; font-size: 10px; font-weight: 700;
    letter-spacing: 0.5px; text-transform: uppercase;
  }
  .sync-bar.online { background: var(--red); color: #fff; }
  .sync-bar.offline { background: var(--blue-light); color: #fff; }

  /* Header */
  .header {
    padding: calc(var(--safe-top) + 28px) 24px 20px;
    background: linear-gradient(180deg, #0d1f3c 0%, var(--bg) 100%);
  }
  .header-row { display: flex; align-items: flex-start; justify-content: space-between; }
  .header h1 {
    font-size: 32px; font-weight: 900; letter-spacing: -1px;
    background: linear-gradient(135deg, #fff 0%, #a8dadc 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .header .dates {
    font-size: 14px; color: var(--text-dim); font-weight: 500; margin-top: 4px;
  }
  .share-btn {
    width: 40px; height: 40px; border-radius: 12px;
    background: rgba(255,255,255,0.08); border: 1px solid var(--border);
    color: var(--text); font-size: 18px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    backdrop-filter: blur(10px);
  }
  .share-btn:active { background: rgba(255,255,255,0.15); }

  /* City legend */
  .city-legend {
    display: flex; gap: 6px; margin-top: 16px; flex-wrap: wrap;
  }
  .legend-item {
    display: flex; align-items: center; gap: 5px;
    font-size: 11px; font-weight: 600; color: var(--text-dim);
    padding: 4px 10px; border-radius: 8px;
    background: rgba(255,255,255,0.04);
  }
  .legend-dot {
    width: 8px; height: 8px; border-radius: 3px;
  }

  /* Calendar */
  .cal-section { padding: 16px 16px 8px; }
  .cal-card {
    background: var(--card); border-radius: 20px;
    padding: 20px; border: 1px solid var(--border);
  }
  .cal-title {
    font-size: 18px; font-weight: 800; text-align: center;
    margin-bottom: 16px; color: #fff;
    letter-spacing: -0.3px;
  }
  .cal-weekdays {
    display: grid; grid-template-columns: repeat(7, 1fr);
    text-align: center; margin-bottom: 8px;
  }
  .cal-wd {
    font-size: 11px; font-weight: 700; color: var(--text-dim);
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .cal-grid {
    display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px;
  }
  .cal-day {
    aspect-ratio: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    border-radius: 14px; font-size: 15px; font-weight: 600;
    cursor: pointer; transition: all 0.15s; position: relative;
  }
  .cal-day.empty { cursor: default; }
  .cal-day.off { color: #2a3a52; cursor: default; }
  .cal-day.trip { color: #fff; }
  .cal-day.trip:active { transform: scale(0.9); }
  .cal-day.selected {
    transform: scale(1.12);
    box-shadow: 0 0 0 2px #fff, 0 4px 20px rgba(230,57,70,0.4);
  }
  .cal-dot-row { display: flex; gap: 2px; margin-top: 2px; }
  .cal-ev-dot {
    width: 3px; height: 3px; border-radius: 50%;
    background: rgba(255,255,255,0.6);
  }

  /* Tabs */
  .tab-bar {
    display: flex; gap: 4px; padding: 0 16px; margin-top: 8px;
    overflow-x: auto; scrollbar-width: none;
  }
  .tab-bar::-webkit-scrollbar { display: none; }
  .tab-btn {
    flex-shrink: 0; padding: 8px 16px; border-radius: 10px;
    border: 1px solid var(--border); background: var(--card);
    color: var(--text-dim); font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.15s; font-family: inherit;
  }
  .tab-btn.active {
    background: var(--red); color: #fff;
    border-color: var(--red); box-shadow: 0 4px 15px rgba(230,57,70,0.3);
  }

  /* Day detail */
  .detail-section { padding: 12px 16px 100px; }

  .detail-card {
    background: var(--card); border-radius: 20px;
    border: 1px solid var(--border); overflow: hidden;
    animation: fadeUp 0.25s ease;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .detail-head {
    padding: 20px 20px 16px;
    background: linear-gradient(135deg, var(--card) 0%, #162440 100%);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
  }
  .detail-left { display: flex; align-items: center; gap: 12px; }
  .detail-icon {
    width: 48px; height: 48px; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
  }
  .detail-label { font-size: 20px; font-weight: 800; color: #fff; letter-spacing: -0.3px; }
  .detail-city {
    font-size: 12px; font-weight: 700; padding: 3px 10px;
    border-radius: 8px; color: #fff; margin-top: 4px; display: inline-block;
  }

  /* Events */
  .events { padding: 8px 0; }
  .ev-item {
    display: flex; align-items: flex-start; padding: 14px 20px; gap: 14px;
    transition: background 0.15s;
  }
  .ev-item:active { background: var(--card-hover); }
  .ev-icon {
    width: 40px; height: 40px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; flex-shrink: 0;
  }
  .ev-icon.flight { background: rgba(99,102,241,0.15); }
  .ev-icon.transport { background: rgba(148,163,184,0.12); }
  .ev-icon.tourism { background: rgba(230,57,70,0.12); }
  .ev-icon.food { background: rgba(249,115,22,0.12); }
  .ev-icon.f1 { background: rgba(230,57,70,0.2); }

  .ev-info { flex: 1; min-width: 0; }
  .ev-time {
    font-size: 11px; font-weight: 700; color: var(--blue-bright);
    text-transform: uppercase; letter-spacing: 0.3px;
  }
  .ev-title { font-size: 15px; font-weight: 700; color: #fff; margin-top: 2px; }
  .ev-detail { font-size: 13px; color: var(--text-dim); margin-top: 2px; }
  .ev-del {
    background: none; border: none; color: var(--red);
    font-size: 18px; cursor: pointer; padding: 4px 8px;
    border-radius: 8px; opacity: 0.5; flex-shrink: 0;
  }
  .ev-del:active { opacity: 1; background: rgba(230,57,70,0.1); }

  .ev-sep { height: 1px; background: var(--border); margin: 0 20px 0 74px; }

  /* Add */
  .add-btn {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    padding: 14px; color: var(--red); font-size: 14px; font-weight: 700;
    cursor: pointer; border: none; background: none; width: 100%;
    font-family: inherit; letter-spacing: -0.2px;
  }
  .add-btn:active { background: var(--card-hover); }

  .add-form {
    padding: 16px 20px 20px; border-top: 1px solid var(--border);
    animation: fadeUp 0.2s ease;
  }
  .f-row { display: flex; gap: 8px; margin-bottom: 8px; }
  .f-input {
    background: rgba(255,255,255,0.06); border: 1px solid var(--border);
    border-radius: 12px; padding: 11px 14px; font-size: 15px;
    font-family: inherit; color: #fff; outline: none; width: 100%;
  }
  .f-input:focus { border-color: var(--red); box-shadow: 0 0 0 2px rgba(230,57,70,0.2); }
  .f-input::placeholder { color: #4a5568; }
  .f-input.time { width: 80px; flex-shrink: 0; }
  .f-select {
    background: rgba(255,255,255,0.06); border: 1px solid var(--border);
    border-radius: 12px; padding: 11px 14px; font-size: 15px;
    font-family: inherit; color: #fff; outline: none;
  }
  .f-actions { display: flex; gap: 8px; margin-top: 4px; }
  .btn-r {
    background: var(--red); color: #fff; border: none;
    padding: 12px 20px; border-radius: 12px; font-size: 15px;
    font-weight: 700; cursor: pointer; flex: 1; font-family: inherit;
  }
  .btn-r:active { background: var(--red-dark); }
  .btn-g {
    background: rgba(255,255,255,0.06); color: var(--text-dim); border: 1px solid var(--border);
    padding: 12px 20px; border-radius: 12px; font-size: 15px;
    font-weight: 600; cursor: pointer; font-family: inherit;
  }

  /* Hint */
  .hint {
    text-align: center; padding: 50px 20px; color: var(--text-dim);
  }
  .hint-icon { font-size: 48px; display: block; margin-bottom: 12px; }
  .hint-text { font-size: 15px; font-weight: 500; line-height: 1.5; }

  /* Modal */
  .modal-bg {
    position: fixed; inset: 0; background: rgba(0,0,0,0.6);
    z-index: 300; display: flex; align-items: flex-end;
    justify-content: center; animation: fadeIn 0.2s;
  }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .modal {
    background: var(--card); border-radius: 24px 24px 0 0;
    padding: 28px 24px calc(var(--safe-bottom) + 28px);
    width: 100%; max-width: 420px;
    animation: slideUp 0.3s ease; border-top: 2px solid var(--red);
  }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
  .modal h2 { font-size: 22px; font-weight: 800; margin-bottom: 6px; color: #fff; }
  .modal p { color: var(--text-dim); font-size: 14px; margin-bottom: 16px; line-height: 1.5; }
  .share-box {
    background: rgba(255,255,255,0.04); border-radius: 14px; padding: 14px;
    display: flex; align-items: center; gap: 10px; margin-bottom: 16px;
    border: 1px solid var(--border);
  }
  .share-box span {
    flex: 1; color: var(--blue-bright); font-size: 13px;
    font-family: ui-monospace, monospace; word-break: break-all;
  }
  .copy-btn {
    background: var(--red); color: #fff; border: none;
    padding: 8px 16px; border-radius: 10px; font-size: 13px;
    font-weight: 700; cursor: pointer; flex-shrink: 0;
  }
  .close-btn {
    background: rgba(255,255,255,0.06); color: var(--text-dim);
    border: 1px solid var(--border); padding: 14px; border-radius: 14px;
    width: 100%; font-size: 16px; font-weight: 600; cursor: pointer;
    font-family: inherit;
  }

  .spacer { height: calc(var(--safe-bottom) + 20px); }
</style>
</head>
<body>
<div id="app"></div>
<script>
const TRIP_DATA = [
  { date:"2026-06-05", label:"Viernes 5", city:"Vuelo", color:"#6366f1", icon:"\u2708\uFE0F",
    events:[{time:"21:45",title:"Vuelo a Madrid",detail:"IB 170 — Salida 9:45pm",type:"flight"}]},
  { date:"2026-06-06", label:"Sábado 6", city:"Madrid", color:"#e63946", icon:"\uD83C\uDFF0",
    events:[{time:"\uD83C\uDF05",title:"Llegada a Madrid",detail:"Check-in y descanso",type:"transport"},
            {time:"\uD83C\uDF06",title:"Paseo por el centro",detail:"Puerta del Sol, Plaza Mayor",type:"tourism"}]},
  { date:"2026-06-07", label:"Domingo 7", city:"Madrid", color:"#e63946", icon:"\uD83C\uDFF0",
    events:[{time:"\uD83C\uDF05",title:"Museo del Prado",detail:"Reservar entrada online",type:"tourism"},
            {time:"\uD83C\uDF06",title:"Parque del Retiro",detail:"Paseo y Palacio de Cristal",type:"tourism"}]},
  { date:"2026-06-08", label:"Lunes 8", city:"Madrid", color:"#e63946", icon:"\uD83C\uDFF0",
    events:[{time:"\uD83C\uDF05",title:"Palacio Real",detail:"Visita guiada",type:"tourism"},
            {time:"\uD83C\uDF06",title:"Barrio de La Latina",detail:"Tapas y paseo",type:"food"}]},
  { date:"2026-06-09", label:"Martes 9", city:"Toledo", color:"#457b9d", icon:"\u2694\uFE0F",
    events:[{time:"\uD83C\uDF05",title:"Excursión a Toledo",detail:"Tren AVE desde Madrid (~30 min)",type:"transport"},
            {time:"\uD83D\uDD50",title:"Casco histórico",detail:"Catedral, Alcázar, calles medievales",type:"tourism"}]},
  { date:"2026-06-10", label:"Miércoles 10", city:"Toledo", color:"#457b9d", icon:"\u2694\uFE0F",
    events:[{time:"\uD83C\uDF05",title:"Toledo día 2",detail:"Sinagoga, Museo del Greco, miradores",type:"tourism"},
            {time:"\uD83C\uDF06",title:"Regreso a Madrid",detail:"Tren de vuelta",type:"transport"}]},
  { date:"2026-06-11", label:"Jueves 11", city:"Barcelona", color:"#1d3557", icon:"\uD83C\uDF0A",
    events:[{time:"\uD83C\uDF05",title:"Viaje a Barcelona",detail:"Traslado y check-in Airbnb",type:"transport"},
            {time:"\uD83C\uDF06",title:"Las Ramblas",detail:"Barrio Gótico, La Boquería",type:"tourism"}]},
  { date:"2026-06-12", label:"Viernes 12", city:"Barcelona", color:"#1d3557", icon:"\uD83C\uDFCE\uFE0F",
    events:[{time:"\uD83C\uDFC1",title:"F1 — Práctica Libre",detail:"Circuit de Barcelona-Catalunya",type:"f1"}]},
  { date:"2026-06-13", label:"Sábado 13", city:"Barcelona", color:"#1d3557", icon:"\uD83C\uDFCE\uFE0F",
    events:[{time:"\uD83C\uDFC1",title:"F1 — Clasificación",detail:"Circuit de Barcelona-Catalunya",type:"f1"}]},
  { date:"2026-06-14", label:"Domingo 14", city:"Barcelona", color:"#1d3557", icon:"\uD83C\uDFCE\uFE0F",
    events:[{time:"\uD83C\uDFC1",title:"F1 — Carrera",detail:"Circuit de Barcelona-Catalunya",type:"f1"}]},
  { date:"2026-06-15", label:"Lunes 15", city:"Barcelona", color:"#1d3557", icon:"\uD83C\uDF0A",
    events:[{time:"\uD83C\uDF05",title:"Sagrada Familia",detail:"Reservar entrada online",type:"tourism"},
            {time:"\uD83C\uDF06",title:"Park Güell",detail:"Zona monumental de Gaudí",type:"tourism"}]},
  { date:"2026-06-16", label:"Martes 16", city:"Barcelona", color:"#1d3557", icon:"\uD83C\uDF0A",
    events:[{time:"\uD83C\uDF05",title:"Barceloneta",detail:"Playa y paseo marítimo",type:"tourism"},
            {time:"\uD83C\uDF06",title:"Casa Batlló / La Pedrera",detail:"Arquitectura de Gaudí",type:"tourism"}]},
  { date:"2026-06-17", label:"Miércoles 17", city:"Valencia", color:"#a8dadc", icon:"\uD83C\uDF4A",
    events:[{time:"\uD83C\uDF05",title:"Viaje a Valencia",detail:"Traslado desde Barcelona",type:"transport"},
            {time:"\uD83C\uDF06",title:"Ciudad de las Artes y las Ciencias",detail:"Oceanogràfic, Hemisfèric",type:"tourism"}]},
  { date:"2026-06-18", label:"Jueves 18", city:"Valencia", color:"#a8dadc", icon:"\uD83C\uDF4A",
    events:[{time:"\uD83C\uDF05",title:"Centro histórico",detail:"Catedral, Lonja de la Seda, Mercado Central",type:"tourism"},
            {time:"\uD83C\uDF06",title:"Playa de la Malvarrosa",detail:"Paella frente al mar",type:"food"}]},
  { date:"2026-06-19", label:"Viernes 19", city:"Madrid", color:"#e63946", icon:"\uD83C\uDFF0",
    events:[{time:"\uD83C\uDF05",title:"Regreso a Madrid",detail:"Traslado desde Valencia",type:"transport"},
            {time:"\uD83C\uDF06",title:"Últimas compras",detail:"Gran Vía, Malasaña, cena de despedida",type:"tourism"}]},
  { date:"2026-06-20", label:"Sábado 20", city:"Vuelo", color:"#6366f1", icon:"\u2708\uFE0F",
    events:[{time:"06:50",title:"Vuelo a Montevideo",detail:"IB 169 — Salida 6:50am",type:"flight"}]}
];

const CITY_COLORS = { Madrid:"#e63946", Toledo:"#457b9d", Barcelona:"#1d3557", Valencia:"#a8dadc", Vuelo:"#6366f1" };
const EVENT_ICONS = { flight:"\u2708\uFE0F", transport:"\uD83D\uDE8C", tourism:"\uD83D\uDCCD", food:"\uD83C\uDF7D\uFE0F", f1:"\uD83C\uDFCE\uFE0F" };
const CITIES = ["Todos","Madrid","Toledo","Barcelona","Valencia"];

let state = { tripData:JSON.parse(JSON.stringify(TRIP_DATA)), selectedDate:null, showAddForm:false, showModal:false, isOnline:false, filter:"Todos" };
let db=null, dbRef=null;

const FIREBASE_CONFIG = {
  apiKey:"AIzaSyDPZPk2nsOQ3oRMG7ADhS56zEFyORTE4QQ",
  authDomain:"flor-y-pato-trip.firebaseapp.com",
  databaseURL:"https://flor-y-pato-trip-default-rtdb.firebaseio.com",
  projectId:"flor-y-pato-trip",
  storageBucket:"flor-y-pato-trip.firebasestorage.app",
  messagingSenderId:"862498607498",
  appId:"1:862498607498:web:7e2ccf24cd913e6cb7c5c3"
};

function initFirebase(c){try{firebase.initializeApp(c);db=firebase.database();dbRef=db.ref('trip-espana-2026');dbRef.on('value',s=>{const d=s.val();if(d&&Array.isArray(d)){state.tripData=d;state.isOnline=true;render()}});db.ref('.info/connected').on('value',s=>{state.isOnline=s.val()===true;render()});dbRef.once('value',s=>{if(!s.val())dbRef.set(TRIP_DATA)});return true}catch(e){return false}}
function saveToFirebase(){if(dbRef)dbRef.set(state.tripData)}

function getTripMap(){const m={};state.tripData.forEach(d=>{m[d.date]=d});return m}

function renderCal(){
  const tm=getTripMap();
  const startOff=0; // June 2026 starts Monday
  let c='';
  for(let i=0;i<startOff;i++) c+='<div class="cal-day empty"></div>';
  for(let d=1;d<=30;d++){
    const ds=`2026-06-${String(d).padStart(2,'0')}`;
    const td=tm[ds]; const sel=state.selectedDate===ds;
    if(td){
      const show = state.filter==="Todos" || td.city===state.filter;
      c+=`<div class="cal-day trip ${sel?'selected':''}" style="background:${td.color}${sel?'':'cc'}${!show?';opacity:0.25':''}" onclick="selDate('${ds}')">${d}<div class="cal-dot-row">${td.events.map(()=>'<div class="cal-ev-dot"></div>').join('')}</div></div>`;
    } else {
      c+=`<div class="cal-day off">${d}</div>`;
    }
  }
  return c;
}

function render(){
  const tm=getTripMap();
  const sd=state.selectedDate?tm[state.selectedDate]:null;
  const cc={};state.tripData.forEach(d=>{if(d.city!=="Vuelo")cc[d.city]=(cc[d.city]||0)+1});

  let h='';

  if(db) h+=`<div class="sync-bar ${state.isOnline?'online':'offline'}">${state.isOnline?'\u25CF En sincro':'\u25CB Sin conexión'}</div>`;

  h+=`<div class="header" style="${db?'padding-top:calc(var(--safe-top) + 36px)':''}">
    <div class="header-row">
      <div><h1>España 2026</h1><div class="dates">5 — 20 de Junio</div></div>
      ${db?'<button class="share-btn" onclick="showModal()">\uD83D\uDD17</button>':''}
    </div>
    <div class="city-legend">
      ${Object.entries(cc).map(([c,n])=>`<div class="legend-item"><div class="legend-dot" style="background:${CITY_COLORS[c]}"></div>${c} · ${n}d</div>`).join('')}
    </div>
  </div>`;

  // Tabs
  h+=`<div class="tab-bar">${CITIES.map(c=>`<button class="tab-btn ${state.filter===c?'active':''}" onclick="setFilter('${c}')">${c}</button>`).join('')}</div>`;

  // Calendar
  h+=`<div class="cal-section"><div class="cal-card">
    <div class="cal-title">Junio 2026</div>
    <div class="cal-weekdays">${['L','M','X','J','V','S','D'].map(d=>`<span class="cal-wd">${d}</span>`).join('')}</div>
    <div class="cal-grid">${renderCal()}</div>
  </div></div>`;

  // Detail
  h+='<div class="detail-section">';
  if(sd){
    h+=`<div class="detail-card">
      <div class="detail-head">
        <div class="detail-left">
          <div class="detail-icon" style="background:${sd.color}22">${sd.icon}</div>
          <div><div class="detail-label">${sd.label}</div><span class="detail-city" style="background:${sd.color}">${sd.city}</span></div>
        </div>
      </div>
      <div class="events">
        ${sd.events.map((ev,j)=>`
          ${j>0?'<div class="ev-sep"></div>':''}
          <div class="ev-item">
            <div class="ev-icon ${ev.type}">${EVENT_ICONS[ev.type]||'\uD83D\uDCCD'}</div>
            <div class="ev-info">
              <div class="ev-time">${ev.time}</div>
              <div class="ev-title">${ev.title}</div>
              <div class="ev-detail">${ev.detail}</div>
            </div>
            <button class="ev-del" onclick="delEv('${sd.date}',${j})">\u00d7</button>
          </div>`).join('')}
      </div>
      ${state.showAddForm?`
        <div class="add-form">
          <div class="f-row"><input class="f-input time" id="nt" placeholder="Hora"><input class="f-input" id="nn" placeholder="Título"></div>
          <div class="f-row"><input class="f-input" id="nd" placeholder="Detalle"></div>
          <div class="f-row"><select class="f-select" id="ny"><option value="tourism">Turismo</option><option value="transport">Transporte</option><option value="food">Comida</option><option value="f1">F1</option><option value="flight">Vuelo</option></select></div>
          <div class="f-actions"><button class="btn-r" onclick="addEv('${sd.date}')">Agregar</button><button class="btn-g" onclick="closeAdd()">Cancelar</button></div>
        </div>`:`<button class="add-btn" onclick="openAdd()">+ Agregar actividad</button>`}
    </div>`;
  } else {
    h+=`<div class="hint"><span class="hint-icon">\uD83D\uDCC5</span><div class="hint-text">Tocá un día del calendario<br>para ver las actividades</div></div>`;
  }
  h+='</div>';

  if(state.showModal){
    const u=window.location.href;
    h+=`<div class="modal-bg" onclick="closeM()"><div class="modal" onclick="event.stopPropagation()">
      <h2>\uD83D\uDD17 Compartir</h2><p>Mandále este link a tu compañero de viaje. Los cambios se sincronizan en tiempo real.</p>
      <div class="share-box"><span>${u}</span><button class="copy-btn" onclick="copyL()">Copiar</button></div>
      <button class="close-btn" onclick="closeM()">Cerrar</button>
    </div></div>`;
  }

  h+='<div class="spacer"></div>';
  document.getElementById('app').innerHTML=h;
}

function selDate(d){state.selectedDate=state.selectedDate===d?null:d;state.showAddForm=false;render();if(state.selectedDate)setTimeout(()=>{const e=document.querySelector('.detail-card');if(e)e.scrollIntoView({behavior:'smooth',block:'nearest'})},50)}
function setFilter(c){state.filter=c;render()}
function delEv(d,i){const x=state.tripData.findIndex(t=>t.date===d);if(x>=0){state.tripData[x].events.splice(i,1);saveToFirebase();render()}}
function openAdd(){state.showAddForm=true;render()}
function closeAdd(){state.showAddForm=false;render()}
function addEv(d){const t=document.getElementById('nt').value||'\uD83D\uDD50',n=document.getElementById('nn').value,de=document.getElementById('nd').value||'',ty=document.getElementById('ny').value;if(!n)return;const x=state.tripData.findIndex(t=>t.date===d);if(x>=0){state.tripData[x].events.push({time:t,title:n,detail:de,type:ty});state.showAddForm=false;saveToFirebase();render()}}
function showModal(){state.showModal=true;render()}
function closeM(){state.showModal=false;render()}
function copyL(){navigator.clipboard.writeText(window.location.href).then(()=>{const b=document.querySelector('.copy-btn');if(b){b.textContent='\u2713';setTimeout(()=>{b.textContent='Copiar'},1500)}})}

(function(){const ok=initFirebase(FIREBASE_CONFIG);if(!ok)state.isOnline=false;render()})();
</script>
</body>
</html>