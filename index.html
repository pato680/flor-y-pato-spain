<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Espa√±a 2026">
<meta name="theme-color" content="#ffffff">
<title>Espa√±a 2026</title>
<link rel="apple-touch-icon" href="icon-180.png">
<link rel="icon" type="image/png" href="icon-180.png">

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

  :root {
    --safe-top: env(safe-area-inset-top, 20px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --red: #D71920; --red-light: #ff2d35; --red-soft: #ffe5e6;
    --blue: #1B3C8C; --blue-light: #2952c4; --blue-soft: #e6ecfa;
    --white: #ffffff;
    --bg: #f2f4f8; --card: #ffffff; --text: #0d1117; --dim: #636c76;
    --border: rgba(0,0,0,0.06);
    --r: 20px;
  }

  body {
    font-family: 'Inter', -apple-system, system-ui, sans-serif;
    background: var(--bg); color: var(--text);
    min-height: 100dvh; overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* ====== SYNC PILL ====== */
  .sync {
    position: fixed; top: calc(var(--safe-top) + 6px); left: 50%; transform: translateX(-50%);
    z-index: 200; padding: 5px 14px; border-radius: 20px;
    font-size: 11px; font-weight: 700; letter-spacing: 0.4px;
    backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    animation: fadeDown 0.5s cubic-bezier(0.16,1,0.3,1);
  }
  @keyframes fadeDown { from{opacity:0;transform:translateX(-50%) translateY(-12px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }
  .sync.on { background: rgba(215,25,32,0.12); color: var(--red); border: 1px solid rgba(215,25,32,0.15); }
  .sync.off { background: rgba(27,60,140,0.1); color: var(--blue); border: 1px solid rgba(27,60,140,0.12); }

  /* ====== HEADER ====== */
  .header {
    padding: calc(var(--safe-top) + 48px) 20px 20px;
    background: var(--blue);
    position: relative; overflow: hidden;
  }
  .header::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse at 20% 50%, rgba(215,25,32,0.15) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(255,255,255,0.08) 0%, transparent 50%);
  }
  .header::after {
    content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, var(--red), var(--white) 50%, var(--red));
  }
  .header-inner { position: relative; z-index: 1; display: flex; align-items: center; gap: 14px; }

  /* Nacional Shield SVG */
  .shield { width: 52px; height: 58px; flex-shrink: 0; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3)); }

  .header-text { flex: 1; }
  .header h1 {
    font-size: 26px; font-weight: 900; color: #fff;
    letter-spacing: -0.5px; line-height: 1.1;
  }
  .header h1 .yr { color: var(--red-light); font-weight: 900; }
  .header .sub { font-size: 13px; color: rgba(255,255,255,0.6); font-weight: 500; margin-top: 4px; }

  .share-btn {
    width: 40px; height: 40px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.1); color: #fff; font-size: 16px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    backdrop-filter: blur(8px); transition: all 0.15s;
  }
  .share-btn:active { transform: scale(0.9); background: rgba(255,255,255,0.2); }

  /* City summary strip */
  .city-strip {
    display: flex; gap: 2px; margin-top: 14px; border-radius: 10px; overflow: hidden;
  }
  .city-bar {
    height: 32px; display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 700; color: #fff; letter-spacing: 0.3px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    transition: flex 0.3s ease;
  }

  /* ====== FILTER TABS ====== */
  .tabs {
    display: flex; gap: 6px; padding: 14px 16px 6px;
    overflow-x: auto; scrollbar-width: none;
  }
  .tabs::-webkit-scrollbar { display: none; }
  .tab {
    flex-shrink: 0; padding: 7px 16px; border-radius: 10px;
    border: none; background: var(--card);
    color: var(--dim); font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.2s; font-family: inherit;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }
  .tab.on {
    background: var(--blue); color: #fff;
    box-shadow: 0 3px 10px rgba(27,60,140,0.25);
  }

  /* ====== CALENDAR ====== */
  .cal-wrap { padding: 6px 12px; }
  .cal {
    background: var(--card); border-radius: var(--r); padding: 16px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  }
  .cal-head {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    margin-bottom: 12px;
  }
  .cal-month { font-size: 15px; font-weight: 800; color: var(--blue); letter-spacing: -0.2px; }
  .cal-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--red); }
  .cal-wk {
    display: grid; grid-template-columns: repeat(7,1fr);
    text-align: center; margin-bottom: 4px;
  }
  .cal-wk span { font-size: 10px; font-weight: 800; color: var(--dim); text-transform: uppercase; letter-spacing: 0.8px; }
  .cal-g { display: grid; grid-template-columns: repeat(7,1fr); gap: 4px; }
  .cd {
    aspect-ratio: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    border-radius: 12px; font-size: 14px; font-weight: 700;
    cursor: pointer; transition: all 0.15s ease; position: relative;
    -webkit-user-select: none; user-select: none;
  }
  .cd.x { color: #ccd0d5; cursor: default; }
  .cd.t { color: #fff; }
  .cd.t:active { transform: scale(0.85); }
  .cd.sel {
    transform: scale(1.18); z-index: 2;
    box-shadow: 0 0 0 2.5px var(--red), 0 6px 16px rgba(215,25,32,0.3);
  }
  .dots { display: flex; gap: 2px; margin-top: 1px; }
  .dot { width: 3px; height: 3px; border-radius: 50%; background: rgba(255,255,255,0.6); }

  /* ====== DAY DETAIL ====== */
  .det-wrap { padding: 6px 12px 120px; }
  .det {
    background: var(--card); border-radius: var(--r); overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    animation: slideUp 0.35s cubic-bezier(0.16,1,0.3,1);
  }
  @keyframes slideUp { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }

  .det-banner {
    padding: 18px 18px 14px; display: flex; align-items: center; gap: 12px;
    position: relative; overflow: hidden;
  }
  .det-banner::before {
    content: ''; position: absolute; inset: 0;
    opacity: 0.06;
  }
  .det-ico {
    width: 48px; height: 48px; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; background: rgba(255,255,255,0.9);
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    position: relative; z-index: 1;
  }
  .det-info { position: relative; z-index: 1; }
  .det-name { font-size: 18px; font-weight: 800; color: var(--text); letter-spacing: -0.3px; }
  .det-badge {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 11px; font-weight: 700; padding: 2px 8px;
    border-radius: 6px; color: #fff; margin-top: 3px;
  }

  /* Events list */
  .evs { padding: 4px 0; }
  .ev {
    display: flex; align-items: flex-start; padding: 12px 18px; gap: 12px;
    transition: background 0.1s;
  }
  .ev:active { background: var(--bg); }
  .ev-ic {
    width: 38px; height: 38px; border-radius: 11px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
  }
  .ev-ic.flight { background: var(--blue-soft); }
  .ev-ic.transport { background: #f0f2f5; }
  .ev-ic.tourism { background: var(--red-soft); }
  .ev-ic.food { background: #fef3c7; }
  .ev-ic.f1 { background: linear-gradient(135deg, var(--red-soft), #ffd6d8); }
  .ev-nfo { flex: 1; min-width: 0; }
  .ev-t { font-size: 10px; font-weight: 700; color: var(--red); letter-spacing: 0.5px; text-transform: uppercase; }
  .ev-n { font-size: 14px; font-weight: 700; color: var(--text); margin-top: 1px; }
  .ev-d { font-size: 12px; color: var(--dim); margin-top: 1px; }
  .ev-x {
    background: none; border: none; color: var(--dim); font-size: 16px;
    cursor: pointer; padding: 4px 6px; border-radius: 8px; opacity: 0.3;
    flex-shrink: 0; transition: all 0.15s;
  }
  .ev-x:active { opacity: 1; color: var(--red); background: var(--red-soft); }
  .ev-sep { height: 1px; background: var(--border); margin: 0 18px 0 68px; }

  /* Add event */
  .add-b {
    display: flex; align-items: center; justify-content: center; gap: 5px;
    padding: 12px; color: var(--blue); font-size: 13px; font-weight: 700;
    cursor: pointer; border: none; background: none; width: 100%;
    font-family: inherit; transition: background 0.15s;
    border-top: 1px solid var(--border);
  }
  .add-b:active { background: var(--blue-soft); }
  .add-f {
    padding: 14px 18px 18px; border-top: 1px solid var(--border);
    animation: slideUp 0.2s ease;
  }
  .fr { display: flex; gap: 6px; margin-bottom: 6px; }
  .fi {
    background: var(--bg); border: 1.5px solid var(--border);
    border-radius: 10px; padding: 10px 12px; font-size: 14px;
    font-family: inherit; color: var(--text); outline: none; width: 100%;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .fi:focus { border-color: var(--blue); box-shadow: 0 0 0 3px rgba(27,60,140,0.1); }
  .fi::placeholder { color: #b0b5bf; }
  .fi.tm { width: 72px; flex-shrink: 0; }
  .fs {
    background: var(--bg); border: 1.5px solid var(--border);
    border-radius: 10px; padding: 10px 12px; font-size: 14px;
    font-family: inherit; color: var(--text); outline: none;
  }
  .fa { display: flex; gap: 6px; margin-top: 4px; }
  .btn-add {
    background: var(--red); color: #fff; border: none;
    padding: 11px 18px; border-radius: 10px; font-size: 14px;
    font-weight: 700; cursor: pointer; flex: 1; font-family: inherit;
    box-shadow: 0 3px 10px rgba(215,25,32,0.2);
    transition: transform 0.15s;
  }
  .btn-add:active { transform: scale(0.97); }
  .btn-cancel {
    background: var(--bg); color: var(--dim); border: 1.5px solid var(--border);
    padding: 11px 18px; border-radius: 10px; font-size: 14px;
    font-weight: 600; cursor: pointer; font-family: inherit;
  }

  /* Hint */
  .hint { text-align: center; padding: 40px 20px; color: var(--dim); }
  .hint-shield { width: 48px; height: 54px; margin: 0 auto 12px; opacity: 0.15; }
  .hint-t { font-size: 14px; font-weight: 500; line-height: 1.5; }

  /* Modal */
  .mbg {
    position: fixed; inset: 0; background: rgba(0,0,0,0.5);
    backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
    z-index: 300; display: flex; align-items: flex-end;
    justify-content: center; animation: fadein .2s;
  }
  @keyframes fadein { from{opacity:0} to{opacity:1} }
  .msh {
    background: #fff; border-radius: 24px 24px 0 0;
    padding: 24px 20px calc(var(--safe-bottom) + 24px);
    width: 100%; max-width: 420px;
    animation: sheetUp .3s cubic-bezier(0.16,1,0.3,1);
  }
  @keyframes sheetUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
  .msh h2 { font-size: 20px; font-weight: 800; color: var(--blue); margin-bottom: 4px; }
  .msh p { color: var(--dim); font-size: 13px; margin-bottom: 14px; line-height: 1.5; }
  .sbox {
    background: var(--bg); border-radius: 12px; padding: 12px;
    display: flex; align-items: center; gap: 8px; margin-bottom: 14px;
  }
  .sbox span { flex: 1; color: var(--blue); font-size: 11px; font-family: ui-monospace, monospace; word-break: break-all; }
  .cpb {
    background: var(--red); color: #fff; border: none;
    padding: 7px 14px; border-radius: 8px; font-size: 12px;
    font-weight: 700; cursor: pointer; flex-shrink: 0;
  }
  .clb {
    background: var(--bg); color: var(--dim); border: none;
    padding: 12px; border-radius: 12px; width: 100%;
    font-size: 15px; font-weight: 600; cursor: pointer; font-family: inherit;
  }

  .spacer { height: calc(var(--safe-bottom) + 20px); }

  /* ===== F1 Splash Animation ===== */
  .splash {
    position: fixed; inset: 0; z-index: 9999;
    background: linear-gradient(135deg, var(--blue) 0%, #0f1d33 100%);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    transition: opacity 0.5s ease, transform 0.5s ease;
    overflow: hidden;
  }
  .splash.hide { opacity: 0; transform: scale(1.05); pointer-events: none; }
  .splash::before, .splash::after {
    content: ''; position: absolute; left: 0; right: 0; height: 2px;
    background: repeating-linear-gradient(90deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 20px, transparent 20px, transparent 40px);
  }
  .splash::before { top: 38%; }
  .splash::after { bottom: 38%; }
  .speed-lines { position: absolute; inset: 0; overflow: hidden; }
  .speed-line {
    position: absolute; height: 1px; background: linear-gradient(90deg, transparent, rgba(215,25,32,0.4), transparent);
    animation: speedLine 0.8s linear infinite;
  }
  @keyframes speedLine { 0%{transform:translateX(-100%)} 100%{transform:translateX(200vw)} }
  .f1-car-wrap {
    position: relative; z-index: 2;
    animation: carEntry 1.2s cubic-bezier(0.16,1,0.3,1) forwards;
  }
  @keyframes carEntry {
    0%{transform:translateX(-120vw) scale(0.8);opacity:0} 40%{opacity:1}
    70%{transform:translateX(0) scale(1)} 85%{transform:translateX(10px) scale(1)}
    100%{transform:translateX(0) scale(1);opacity:1}
  }
  .f1-car { font-size: 72px; filter: drop-shadow(0 0 30px rgba(215,25,32,0.5)); animation: carBounce 0.6s ease-in-out infinite alternate; animation-delay: 1.2s; }
  @keyframes carBounce { 0%{transform:translateY(0)} 100%{transform:translateY(-3px)} }
  .smoke {
    position: absolute; bottom: -10px; left: -60px;
    width: 80px; height: 30px; border-radius: 50%;
    background: radial-gradient(ellipse, rgba(255,255,255,0.3), transparent);
    animation: smokeAnim 1s ease-out forwards; animation-delay: 0.8s; opacity: 0;
  }
  @keyframes smokeAnim { 0%{opacity:0;transform:scale(0.5) translateX(0)} 50%{opacity:0.6} 100%{opacity:0;transform:scale(2) translateX(-40px)} }
  .splash-title {
    position: relative; z-index: 2; margin-top: 28px; text-align: center;
    animation: titleReveal 0.6s cubic-bezier(0.16,1,0.3,1) forwards;
    animation-delay: 0.7s; opacity: 0; transform: translateY(20px);
  }
  @keyframes titleReveal { to{opacity:1;transform:translateY(0)} }
  .splash-title h2 { font-size: 32px; font-weight: 900; color: #fff; letter-spacing: -1px; text-shadow: 0 2px 20px rgba(0,0,0,0.3); }
  .splash-title h2 .red { color: var(--red); }
  .splash-title .year { font-size: 14px; font-weight: 600; color: rgba(255,255,255,0.5); letter-spacing: 6px; margin-top: 6px; text-transform: uppercase; }
  .checkered {
    position: absolute; bottom: 0; left: 0; right: 0; height: 24px;
    display: flex; flex-wrap: wrap;
    animation: checkReveal 0.4s ease forwards; animation-delay: 1s; opacity: 0;
  }
  @keyframes checkReveal { to{opacity:1} }
  .checkered span { width: 12px; height: 12px; display: inline-block; }
  .splash-dots {
    position: relative; z-index: 2; margin-top: 20px;
    display: flex; gap: 6px;
    animation: titleReveal 0.5s ease forwards; animation-delay: 1s; opacity: 0;
  }
  .splash-dots span { width: 6px; height: 6px; border-radius: 50%; background: var(--red); animation: dotPulse 1s ease infinite; }
  .splash-dots span:nth-child(2) { animation-delay: 0.2s; }
  .splash-dots span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes dotPulse { 0%,80%,100%{opacity:0.3;transform:scale(0.8)} 40%{opacity:1;transform:scale(1.2)} }
</style>
</head>
<body>
<div id="splash" class="splash">
  <div class="speed-lines">
    <div class="speed-line" style="top:20%;width:40%;animation-delay:0.1s;animation-duration:0.7s"></div>
    <div class="speed-line" style="top:35%;width:60%;animation-delay:0.3s;animation-duration:0.6s"></div>
    <div class="speed-line" style="top:50%;width:35%;animation-delay:0s;animation-duration:0.8s"></div>
    <div class="speed-line" style="top:65%;width:50%;animation-delay:0.2s;animation-duration:0.65s"></div>
    <div class="speed-line" style="top:80%;width:45%;animation-delay:0.4s;animation-duration:0.75s"></div>
  </div>
  <div class="f1-car-wrap">
    <div class="f1-car">üèéÔ∏è</div>
    <div class="smoke"></div>
  </div>
  <div class="splash-title">
    <h2>Espa√±a <span class="red">F1</span></h2>
    <div class="year">Junio 2026</div>
  </div>
  <div class="splash-dots"><span></span><span></span><span></span></div>
  <div class="checkered" id="checkered"></div>
</div>
<div id="app"></div>
<script>
// Nacional shield as inline SVG
const SHIELD_SVG=`<svg viewBox="0 0 100 112" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="shieldBg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1B3C8C"/>
      <stop offset="100%" stop-color="#142d6b"/>
    </linearGradient>
  </defs>
  <!-- Shield shape -->
  <path d="M50 2 L96 18 C96 18 98 60 78 86 C64 104 50 110 50 110 C50 110 36 104 22 86 C2 60 4 18 4 18 Z" fill="url(#shieldBg)" stroke="#c9a726" stroke-width="2.5"/>
  <!-- Inner border -->
  <path d="M50 8 L90 22 C90 22 92 58 74 82 C62 97 50 103 50 103 C50 103 38 97 26 82 C8 58 10 22 10 22 Z" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
  <!-- Red diagonal stripe -->
  <path d="M30 15 L75 95 L65 100 L18 22 Z" fill="#D71920" opacity="0.9"/>
  <!-- C N F text -->
  <text x="50" y="48" text-anchor="middle" font-family="Inter,Arial,sans-serif" font-weight="900" font-size="16" fill="white" letter-spacing="1">C N F</text>
  <!-- NACIONAL text -->
  <text x="50" y="68" text-anchor="middle" font-family="Inter,Arial,sans-serif" font-weight="700" font-size="7" fill="rgba(255,255,255,0.8)" letter-spacing="2.5">NACIONAL</text>
  <!-- Star -->
  <polygon points="50,76 52,82 58,82 53,86 55,92 50,88 45,92 47,86 42,82 48,82" fill="#c9a726"/>
</svg>`;

const SHIELD_HINT=`<svg viewBox="0 0 100 112" xmlns="http://www.w3.org/2000/svg">
  <path d="M50 2 L96 18 C96 18 98 60 78 86 C64 104 50 110 50 110 C50 110 36 104 22 86 C2 60 4 18 4 18 Z" fill="#1B3C8C" stroke="#c9a726" stroke-width="2.5"/>
  <path d="M30 15 L75 95 L65 100 L18 22 Z" fill="#D71920" opacity="0.9"/>
  <text x="50" y="48" text-anchor="middle" font-family="Inter,sans-serif" font-weight="900" font-size="16" fill="white">C N F</text>
  <text x="50" y="68" text-anchor="middle" font-family="Inter,sans-serif" font-weight="700" font-size="7" fill="rgba(255,255,255,0.8)" letter-spacing="2.5">NACIONAL</text>
</svg>`;

const TRIP=[
  {date:"2026-06-05",label:"Viernes 5",city:"Vuelo",color:"#6366f1",icon:"‚úàÔ∏è",events:[{time:"21:45",title:"Vuelo a Madrid",detail:"IB 170 ‚Äî Salida 9:45pm",type:"flight"}]},
  {date:"2026-06-06",label:"S√°bado 6",city:"Madrid",color:"#D71920",icon:"üè∞",events:[{time:"üåÖ",title:"Llegada a Madrid",detail:"Check-in y descanso",type:"transport"},{time:"üåÜ",title:"Paseo por el centro",detail:"Puerta del Sol, Plaza Mayor",type:"tourism"}]},
  {date:"2026-06-07",label:"Domingo 7",city:"Madrid",color:"#D71920",icon:"üè∞",events:[{time:"üåÖ",title:"Museo del Prado",detail:"Reservar entrada online",type:"tourism"},{time:"üåÜ",title:"Parque del Retiro",detail:"Paseo y Palacio de Cristal",type:"tourism"}]},
  {date:"2026-06-08",label:"Lunes 8",city:"Madrid",color:"#D71920",icon:"üè∞",events:[{time:"üåÖ",title:"Palacio Real",detail:"Visita guiada",type:"tourism"},{time:"üåÜ",title:"Barrio de La Latina",detail:"Tapas y paseo",type:"food"}]},
  {date:"2026-06-09",label:"Martes 9",city:"Toledo",color:"#457b9d",icon:"‚öîÔ∏è",events:[{time:"üåÖ",title:"Excursi√≥n a Toledo",detail:"Tren AVE (~30 min)",type:"transport"},{time:"üïê",title:"Casco hist√≥rico",detail:"Catedral, Alc√°zar, calles medievales",type:"tourism"}]},
  {date:"2026-06-10",label:"Mi√©rcoles 10",city:"Toledo",color:"#457b9d",icon:"‚öîÔ∏è",events:[{time:"üåÖ",title:"Toledo d√≠a 2",detail:"Sinagoga, Museo del Greco, miradores",type:"tourism"},{time:"üåÜ",title:"Regreso a Madrid",detail:"Tren de vuelta",type:"transport"}]},
  {date:"2026-06-11",label:"Jueves 11",city:"Barcelona",color:"#1B3C8C",icon:"üåä",events:[{time:"üåÖ",title:"Viaje a Barcelona",detail:"Traslado y check-in Airbnb",type:"transport"},{time:"üåÜ",title:"Las Ramblas",detail:"Barrio G√≥tico, La Boquer√≠a",type:"tourism"}]},
  {date:"2026-06-12",label:"Viernes 12",city:"Barcelona",color:"#1B3C8C",icon:"üèéÔ∏è",events:[{time:"üèÅ",title:"F1 ‚Äî Pr√°ctica Libre",detail:"Circuit de Barcelona-Catalunya",type:"f1"}]},
  {date:"2026-06-13",label:"S√°bado 13",city:"Barcelona",color:"#1B3C8C",icon:"üèéÔ∏è",events:[{time:"üèÅ",title:"F1 ‚Äî Clasificaci√≥n",detail:"Circuit de Barcelona-Catalunya",type:"f1"}]},
  {date:"2026-06-14",label:"Domingo 14",city:"Barcelona",color:"#1B3C8C",icon:"üèéÔ∏è",events:[{time:"üèÅ",title:"F1 ‚Äî Carrera",detail:"Circuit de Barcelona-Catalunya",type:"f1"}]},
  {date:"2026-06-15",label:"Lunes 15",city:"Barcelona",color:"#1B3C8C",icon:"üåä",events:[{time:"üåÖ",title:"Sagrada Familia",detail:"Reservar entrada online",type:"tourism"},{time:"üåÜ",title:"Park G√ºell",detail:"Zona monumental de Gaud√≠",type:"tourism"}]},
  {date:"2026-06-16",label:"Martes 16",city:"Barcelona",color:"#1B3C8C",icon:"üåä",events:[{time:"üåÖ",title:"Barceloneta",detail:"Playa y paseo mar√≠timo",type:"tourism"},{time:"üåÜ",title:"Casa Batll√≥ / La Pedrera",detail:"Arquitectura de Gaud√≠",type:"tourism"}]},
  {date:"2026-06-17",label:"Mi√©rcoles 17",city:"Valencia",color:"#2a9d8f",icon:"üçä",events:[{time:"üåÖ",title:"Viaje a Valencia",detail:"Traslado desde Barcelona",type:"transport"},{time:"üåÜ",title:"Ciudad de las Artes y las Ciencias",detail:"Oceanogr√†fic, Hemisf√®ric",type:"tourism"}]},
  {date:"2026-06-18",label:"Jueves 18",city:"Valencia",color:"#2a9d8f",icon:"üçä",events:[{time:"üåÖ",title:"Centro hist√≥rico",detail:"Catedral, Lonja de la Seda, Mercado Central",type:"tourism"},{time:"üåÜ",title:"Playa de la Malvarrosa",detail:"Paella frente al mar",type:"food"}]},
  {date:"2026-06-19",label:"Viernes 19",city:"Madrid",color:"#D71920",icon:"üè∞",events:[{time:"üåÖ",title:"Regreso a Madrid",detail:"Traslado desde Valencia",type:"transport"},{time:"üåÜ",title:"√öltimas compras",detail:"Gran V√≠a, Malasa√±a, cena de despedida",type:"tourism"}]},
  {date:"2026-06-20",label:"S√°bado 20",city:"Vuelo",color:"#6366f1",icon:"‚úàÔ∏è",events:[{time:"06:50",title:"Vuelo a Montevideo",detail:"IB 169 ‚Äî Salida 6:50am",type:"flight"}]}
];
const CC={Madrid:"#D71920",Toledo:"#457b9d",Barcelona:"#1B3C8C",Valencia:"#2a9d8f",Vuelo:"#6366f1"};
const EI={flight:"‚úàÔ∏è",transport:"üöå",tourism:"üìç",food:"üçΩÔ∏è",f1:"üèéÔ∏è"};
const CTS=["Todos","Madrid","Toledo","Barcelona","Valencia"];

let S={data:JSON.parse(JSON.stringify(TRIP)),sel:null,add:false,modal:false,on:false,filt:"Todos"};
let db=null,ref=null;

const FC={apiKey:"AIzaSyDPZPk2nsOQ3oRMG7ADhS56zEFyORTE4QQ",authDomain:"flor-y-pato-trip.firebaseapp.com",databaseURL:"https://flor-y-pato-trip-default-rtdb.firebaseio.com",projectId:"flor-y-pato-trip",storageBucket:"flor-y-pato-trip.firebasestorage.app",messagingSenderId:"862498607498",appId:"1:862498607498:web:7e2ccf24cd913e6cb7c5c3"};

function initFB(){try{firebase.initializeApp(FC);db=firebase.database();ref=db.ref('trip-espana-2026');ref.on('value',s=>{const d=s.val();if(d&&Array.isArray(d)){S.data=d;S.on=true;R()}});db.ref('.info/connected').on('value',s=>{S.on=s.val()===true;R()});ref.once('value',s=>{if(!s.val())ref.set(TRIP)});return true}catch(e){return false}}
function save(){if(ref)ref.set(S.data)}
function tm(){const m={};S.data.forEach(d=>{m[d.date]=d});return m}

function cal(){
  const t=tm();let c='';
  for(let d=1;d<=30;d++){
    const ds=`2026-06-${String(d).padStart(2,'0')}`,td=t[ds],sl=S.sel===ds;
    if(td){const sh=S.filt==="Todos"||td.city===S.filt;
      c+=`<div class="cd t ${sl?'sel':''}" style="background:${td.color}${sl?'':'cc'}${!sh?';opacity:0.15':''}" onclick="sel('${ds}')">${d}<div class="dots">${td.events.map(()=>'<div class="dot"></div>').join('')}</div></div>`;
    }else c+=`<div class="cd x">${d}</div>`;
  }
  return c;
}

function R(){
  const t=tm(),sd=S.sel?t[S.sel]:null;
  const cnt={};S.data.forEach(d=>{if(d.city!=="Vuelo")cnt[d.city]=(cnt[d.city]||0)+1});
  const total=Object.values(cnt).reduce((a,b)=>a+b,0);
  let h='';

  if(db)h+=`<div class="sync ${S.on?'on':'off'}">${S.on?'‚óè Sincronizado':'‚óã Offline'}</div>`;

  // Header with Nacional shield
  h+=`<div class="header">
    <div class="header-inner">
      <div class="shield">${SHIELD_SVG}</div>
      <div class="header-text">
        <h1>Espa√±a <span class="yr">2026</span></h1>
        <div class="sub">5 ‚Äî 20 de Junio ¬∑ 16 d√≠as</div>
      </div>
      ${db?'<button class="share-btn" onclick="sM()">üîó</button>':''}
    </div>
    <div class="city-strip">${Object.entries(cnt).map(([c,n])=>
      `<div class="city-bar" style="flex:${n};background:${CC[c]}">${c}</div>`
    ).join('')}</div>
  </div>`;

  // Tabs
  h+=`<div class="tabs">${CTS.map(c=>`<button class="tab ${S.filt===c?'on':''}" onclick="flt('${c}')">${c}</button>`).join('')}</div>`;

  // Calendar
  h+=`<div class="cal-wrap"><div class="cal">
    <div class="cal-head"><div class="cal-dot"></div><div class="cal-month">Junio 2026</div><div class="cal-dot"></div></div>
    <div class="cal-wk">${['L','M','X','J','V','S','D'].map(d=>`<span>${d}</span>`).join('')}</div>
    <div class="cal-g">${cal()}</div>
  </div></div>`;

  // Detail or hint
  h+='<div class="det-wrap">';
  if(sd){
    h+=`<div class="det">
      <div class="det-banner" style="background:linear-gradient(135deg, ${sd.color}08, ${sd.color}04)">
        <div class="det-ico">${sd.icon}</div>
        <div class="det-info">
          <div class="det-name">${sd.label}</div>
          <span class="det-badge" style="background:${sd.color}">${sd.city}</span>
        </div>
      </div>
      <div class="evs">${sd.events.map((e,j)=>`
        ${j?'<div class="ev-sep"></div>':''}
        <div class="ev">
          <div class="ev-ic ${e.type}">${EI[e.type]||'üìç'}</div>
          <div class="ev-nfo"><div class="ev-t">${e.time}</div><div class="ev-n">${e.title}</div><div class="ev-d">${e.detail}</div></div>
          <button class="ev-x" onclick="del('${sd.date}',${j})">√ó</button>
        </div>`).join('')}</div>
      ${S.add?`<div class="add-f">
        <div class="fr"><input class="fi tm" id="nt" placeholder="Hora"><input class="fi" id="nn" placeholder="T√≠tulo"></div>
        <div class="fr"><input class="fi" id="nd" placeholder="Detalle"></div>
        <div class="fr"><select class="fs" id="ny"><option value="tourism">Turismo</option><option value="transport">Transporte</option><option value="food">Comida</option><option value="f1">F1</option><option value="flight">Vuelo</option></select></div>
        <div class="fa"><button class="btn-add" onclick="addE('${sd.date}')">Agregar</button><button class="btn-cancel" onclick="S.add=false;R()">Cancelar</button></div>
      </div>`:`<button class="add-b" onclick="S.add=true;R()">+ Agregar actividad</button>`}
    </div>`;
  }else{
    h+=`<div class="hint"><div class="hint-shield">${SHIELD_HINT}</div><div class="hint-t">Toc√° un d√≠a del calendario<br>para ver las actividades</div></div>`;
  }
  h+='</div>';

  if(S.modal){const u=location.href;
    h+=`<div class="mbg" onclick="cM()"><div class="msh" onclick="event.stopPropagation()">
      <h2>üîó Compartir</h2><p>Mand√°le este link a tu compa√±ero de viaje. Los cambios se sincronizan al instante.</p>
      <div class="sbox"><span>${u}</span><button class="cpb" onclick="cpL()">Copiar</button></div>
      <button class="clb" onclick="cM()">Cerrar</button>
    </div></div>`;
  }
  h+='<div class="spacer"></div>';
  document.getElementById('app').innerHTML=h;
}

function sel(d){S.sel=S.sel===d?null:d;S.add=false;R();if(S.sel)setTimeout(()=>{const e=document.querySelector('.det');if(e)e.scrollIntoView({behavior:'smooth',block:'nearest'})},60)}
function flt(c){S.filt=c;R()}
function del(d,i){const x=S.data.findIndex(t=>t.date===d);if(x>=0){S.data[x].events.splice(i,1);save();R()}}
function addE(d){const t=document.getElementById('nt').value||'üïê',n=document.getElementById('nn').value,de=document.getElementById('nd').value||'',ty=document.getElementById('ny').value;if(!n)return;const x=S.data.findIndex(t=>t.date===d);if(x>=0){S.data[x].events.push({time:t,title:n,detail:de,type:ty});S.add=false;save();R()}}
function sM(){S.modal=true;R()}
function cM(){S.modal=false;R()}
function cpL(){navigator.clipboard.writeText(location.href).then(()=>{const b=document.querySelector('.cpb');if(b){b.textContent='‚úì';setTimeout(()=>b.textContent='Copiar',1500)}})}

(function(){
  const ch=document.getElementById('checkered');
  if(ch){
    const cols=Math.ceil(window.innerWidth/12);
    for(let r=0;r<2;r++)for(let c=0;c<cols;c++){
      const s=document.createElement('span');
      s.style.background=(r+c)%2===0?'#fff':'#222';
      ch.appendChild(s);
    }
  }
  initFB();R();
  setTimeout(()=>{
    const sp=document.getElementById('splash');
    if(sp){sp.classList.add('hide');setTimeout(()=>sp.remove(),600);}
  },2600);
})();
</script>
</body>
</html>
